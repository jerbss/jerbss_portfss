{% extends "main/base.html" %}
{% load static %}
{% load cloudinary_images %}

{% block title %}Home - Portfolio{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="container py-5">
    <div class="row align-items-center">
        <!-- Coluna para todo o texto (desktop) e para sauda√ß√£o/nome/apelidos (mobile) -->
        <div class="col-md-6 order-1">
            <!-- Sauda√ß√£o, nome e apelidos (vis√≠veis em todos os dispositivos) -->
            <h1 class="display-4 fw-bold">
                <div id="greeting" class="greeting-animation mb-2">Ol√°!</div>
                <div>Eu sou Jerbesson</div>
                <div class="nicknames">Mas pode me chamar de Jerb, Jerbin, Jerbinho, Jerb√£o, Jherber, Jej√©, GG ou Jerdelicia</div>
            </h1>
            
            <!-- Bio e bot√µes (vis√≠veis apenas em desktop) -->
            <div class="d-none d-md-block">
                <p class="lead mb-4">
                    Tenho 23 anos, moro em Fortaleza/CE e curso <span class="highlight">Sistemas e M√≠dias Digitais</span> na <span class="highlight">UFC</span>. Minha pegada √© fugir de padr√µes e pensar fora da caixa (na verdade, <span class="highlight">odeio caixas!</span>). Curioso(a) pra ver minha mente ca√≥tica em a√ß√£o? Os bot√µes a√≠ est√£o te chamando!
                </p>
                <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                    <a href="{% url 'main:projects' %}" class="btn btn-primary btn-lg px-4 me-md-2">
                        <i class="fas fa-code me-2"></i>Ver Meus Projetos
                    </a>
                    <a href="{% url 'main:contact' %}" class="btn btn-outline-secondary btn-lg px-4">
                        <i class="fas fa-paper-plane me-2"></i>Me Mande um Salve!
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Imagem em desktop (√† direita) e mobile (ap√≥s apelidos) -->
        <div class="col-12 col-md-6 order-2 text-center mb-4 mb-md-0">
            <img src="{% home_image_url 'profile_photo_1.png' %}" class="img-fluid rounded-circle" alt="Foto de Perfil">
        </div>
        
        <!-- Bio e bot√µes apenas em mobile (ap√≥s a imagem) -->
        <div class="col-12 d-md-none order-3">
            <p class="lead mb-4">
                Tenho 23 anos, moro em Fortaleza/CE, e curso <span class="highlight">Sistemas e M√≠dias Digitais</span> na <span class="highlight">UFC</span>. Adoro quebrar padr√µes e pensar fora da caixa (na verdade, <span class="highlight">odeio caixas!</span>). Curioso pra ver minha mente ca√≥tica em a√ß√£o? Os bot√µes a√≠ est√£o te chamando!
            </p>
            <div class="d-grid gap-2">
                <a href="{% url 'main:projects' %}" class="btn btn-primary btn-lg px-4 me-md-2">
                    <i class="fas fa-code me-2"></i>Ver Meus Projetos
                </a>
                <a href="{% url 'main:contact' %}" class="btn btn-outline-secondary btn-lg px-4">
                    <i class="fas fa-paper-plane me-2"></i>Me Mande um Salve!
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Professional Experience Section -->
<div class="container my-5">
    <h2 class="display-6 fw-bold mb-4">Experi√™ncia Profissional</h2>
    <div class="card">
        <div class="card-body text-center py-5">
            <h3 class="h5 mb-4">Experi√™ncia profissional? Error 404: Not Found üíª</h3>
            <p class="mb-4">Tente a seguinte solu√ß√£o: <span class="highlight">1)</span> Veja meus projetos <span class="highlight">2)</span> Fique impressionado(a) <span class="highlight">3)</span> Me contrate!</p>
            <a href="{% url 'main:projects' %}" class="btn btn-primary btn-lg">
                <i class="fas fa-terminal me-2"></i>Executar Solu√ß√£o.exe
            </a>
        </div>
    </div>
</div>

<!-- Areas of Interest Section -->
<div class="container my-5">
    <h2 class="display-6 fw-bold mb-4">Coisas que Curto Aprender</h2>
    <div class="row g-4">
        <div class="col-md-6 col-lg-3">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <div class="card-header-custom mb-3">
                        <h3 class="h5">Linguagens e Comunica√ß√£o</h3>
                    </div>
                    <div class="card-content">
                        <ul class="list-unstyled">
                            <li>Idiomas: Ingl√™s e Japon√™s</li>
                            <li>Cria√ß√£o de Narrativas e Roteiros</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <div class="card-header-custom mb-3">
                        <h3 class="h5">UX Design</h3>
                    </div>
                    <div class="card-content">
                        <ul class="list-unstyled">
                            <li>Interaction Design (IxD)</li>
                            <li>UX Research</li>
                            <li>UX Write</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <div class="card-header-custom mb-3">
                        <h3 class="h5">Tecnologia e Desenvolvimento</h3>
                    </div>
                    <div class="card-content">
                        <ul class="list-unstyled">
                            <li>Desenvolvimento Web: Front-End, Back-End</li>
                            <li>Ci√™ncia de Dados</li>
                            <li>Intelig√™ncia Artificial</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <div class="card-header-custom mb-3">
                        <h3 class="h5">Gest√£o e Planejamento</h3>
                    </div>
                    <div class="card-content">
                        <ul class="list-unstyled">
                            <li>Gerenciamento de Projetos</li>
                            <li>Design Thinking</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- TOP 3 Section -->
<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="display-6 fw-bold mb-0">Meus TOP 3</h2>
        {% if user.is_superuser %}
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addTop3Modal">
                <i class="fas fa-plus-circle me-1"></i> Adicionar TOP 3
            </button>
        {% endif %}
    </div>
    
    <!-- Dynamic TOP 3 Cards - All cards are now from database -->
    {% if top3_cards %}
    <div class="row g-4">
        {% for card in top3_cards %}
            <div class="col-md-6 {% if forloop.counter|divisibleby:2 and not forloop.first %}mt-4{% endif %}">
                <div class="card h-100">
                    {% if user.is_superuser %}
                    <div class="card-admin-controls">
                        <button type="button" class="btn btn-sm btn-primary edit-top3-btn" 
                                data-id="{{ card.id }}"
                                data-bs-toggle="modal" 
                                data-bs-target="#addTop3Modal">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-danger delete-top3-btn"
                                data-id="{{ card.id }}"
                                data-title="{{ card.title }}"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteTop3Modal">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    {% endif %}
                    <div class="card-body">
                        <h3 class="h5 mb-3">
                            <i class="{{ card.icon_class }}"></i><span class="ms-2">{{ card.title }}</span>
                        </h3>

                        <!-- First item -->
                        <div class="d-flex align-items-center mb-3">
                            {% if card.item1_link %}
                            <a href="{{ card.item1_link }}" target="_blank" style="position: relative; display: inline-block;">
                                <img
                                    src="{{ card.item1_image.url }}"
                                    alt="{{ card.item1_name }}"
                                    class="rounded-circle me-3 hover-darken"
                                    style="width: 60px; height: 60px; object-fit: cover;"
                                />
                                <i class="fas fa-external-link-alt redirect-icon"></i>
                            </a>
                            {% else %}
                            <div style="position: relative; display: inline-block;">
                                <img
                                    src="{{ card.item1_image.url }}"
                                    alt="{{ card.item1_name }}"
                                    class="rounded-circle me-3"
                                    style="width: 60px; height: 60px; object-fit: cover;"
                                />
                            </div>
                            {% endif %}
                            <span>{{ card.item1_name }}</span>
                        </div>

                        <!-- Second item -->
                        <div class="d-flex align-items-center mb-3">
                            {% if card.item2_link %}
                            <a href="{{ card.item2_link }}" target="_blank" style="position: relative; display: inline-block;">
                                <img
                                    src="{{ card.item2_image.url }}"
                                    alt="{{ card.item2_name }}"
                                    class="rounded-circle me-3 hover-darken"
                                    style="width: 60px; height: 60px; object-fit: cover;"
                                />
                                <i class="fas fa-external-link-alt redirect-icon"></i>
                            </a>
                            {% else %}
                            <div style="position: relative; display: inline-block;">
                                <img
                                    src="{{ card.item2_image.url }}"
                                    alt="{{ card.item2_name }}"
                                    class="rounded-circle me-3"
                                    style="width: 60px; height: 60px; object-fit: cover;"
                                />
                            </div>
                            {% endif %}
                            <span>{{ card.item2_name }}</span>
                        </div>

                        <!-- Third item -->
                        <div class="d-flex align-items-center mb-3">
                            {% if card.item3_link %}
                            <a href="{{ card.item3_link }}" target="_blank" style="position: relative; display: inline-block;">
                                <img
                                    src="{{ card.item3_image.url }}"
                                    alt="{{ card.item3_name }}"
                                    class="rounded-circle me-3 hover-darken"
                                    style="width: 60px; height: 60px; object-fit: cover;"
                                />
                                <i class="fas fa-external-link-alt redirect-icon"></i>
                            </a>
                            {% else %}
                            <div style="position: relative; display: inline-block;">
                                <img
                                    src="{{ card.item3_image.url }}"
                                    alt="{{ card.item3_name }}"
                                    class="rounded-circle me-3"
                                    style="width: 60px; height: 60px; object-fit: cover;"
                                />
                            </div>
                            {% endif %}
                            <span>{{ card.item3_name }}</span>
                        </div>

                        <p class="text-muted fst-italic small mt-2">
                            <i class="fas fa-laugh-wink me-1"></i>
                            {{ card.fun_comment }}
                        </p>
                    </div>
                </div>
            </div>
            {% if forloop.counter|divisibleby:2 and not forloop.last %}
                </div><div class="row g-4 mt-1">
            {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <p>Nenhum cart√£o TOP 3 encontrado. Adicione seu primeiro TOP 3!</p>
    </div>
    {% endif %}
    
    <!-- CTA para Sugest√µes de TOP 3 - Vers√£o Reformulada -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card top3-cta">
                <div class="card-body text-center py-4">
                    <h3 class="h5 mb-3">Qual seria o seu TOP 3?</h3>
                    <p class="mb-4">Compartilhe seus gostos e ideias para novos temas de TOP 3!</p>
                    <a href="{% url 'main:contact' %}" class="btn btn-primary">
                        <i class="fas fa-lightbulb me-2"></i>Sugerir um Tema
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add TOP3 Modal -->
{% if user.is_superuser %}
<div class="modal fade" id="addTop3Modal" tabindex="-1" aria-labelledby="addTop3ModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTop3ModalLabel">Adicionar Novo TOP 3</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="top3Form" method="post" action="{% url 'main:add_top3' %}" enctype="multipart/form-data">
                <div class="modal-body">
                    {% csrf_token %}
                    <input type="hidden" name="top3_id" id="top3_id" value="">
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="icon_class" class="form-label">Classe do √çcone <small>(FontAwesome)</small></label>
                            <input type="text" class="form-control" id="icon_class" name="icon_class" required 
                                   placeholder="Ex: fas fa-music">
                            <div class="form-text">Confira √≠cones em <a href="https://fontawesome.com/icons" target="_blank">FontAwesome</a>. N√£o √© necess√°rio adicionar a classe de espa√ßamento.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="title" class="form-label">T√≠tulo</label>
                            <input type="text" class="form-control" id="title" name="title" required
                                   placeholder="Ex: M√∫sicas">
                        </div>
                    </div>
                    
                    <div class="card mb-3">
                        <div class="card-header bg-light">Item 1</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="item1_name" class="form-label">Nome</label>
                                    <input type="text" class="form-control" id="item1_name" name="item1_name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="item1_link" class="form-label">Link (opcional)</label>
                                    <input type="url" class="form-control" id="item1_link" name="item1_link">
                                </div>
                                <div class="col-12">
                                    <label for="item1_image" class="form-label">Imagem</label>
                                    <!-- Container para pr√©-visualiza√ß√£o da imagem -->
                                    <div class="image-preview mb-2" id="item1_image_preview" style="display: none;">
                                        <img src="" alt="Preview" class="img-thumbnail" style="height: 100px; width: 100px; object-fit: cover; border-radius: 50%;">
                                        <div class="mt-1 text-muted small">Imagem atual (n√£o ser√° alterada a menos que voc√™ fa√ßa upload de uma nova)</div>
                                    </div>
                                    <input type="file" class="form-control" id="item1_image" name="item1_image" accept="image/*" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-3">
                        <div class="card-header bg-light">Item 2</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="item2_name" class="form-label">Nome</label>
                                    <input type="text" class="form-control" id="item2_name" name="item2_name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="item2_link" class="form-label">Link (opcional)</label>
                                    <input type="url" class="form-control" id="item2_link" name="item2_link">
                                </div>
                                <div class="col-12">
                                    <label for="item2_image" class="form-label">Imagem</label>
                                    <!-- Container para pr√©-visualiza√ß√£o da imagem -->
                                    <div class="image-preview mb-2" id="item2_image_preview" style="display: none;">
                                        <img src="" alt="Preview" class="img-thumbnail" style="height: 100px; width: 100px; object-fit: cover; border-radius: 50%;">
                                        <div class="mt-1 text-muted small">Imagem atual (n√£o ser√° alterada a menos que voc√™ fa√ßa upload de uma nova)</div>
                                    </div>
                                    <input type="file" class="form-control" id="item2_image" name="item2_image" accept="image/*" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-3">
                        <div class="card-header bg-light">Item 3</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="item3_name" class="form-label">Nome</label>
                                    <input type="text" class="form-control" id="item3_name" name="item3_name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="item3_link" class="form-label">Link (opcional)</label>
                                    <input type="url" class="form-control" id="item3_link" name="item3_link">
                                </div>
                                <div class="col-12">
                                    <label for="item3_image" class="form-label">Imagem</label>
                                    <!-- Container para pr√©-visualiza√ß√£o da imagem -->
                                    <div class="image-preview mb-2" id="item3_image_preview" style="display: none;">
                                        <img src="" alt="Preview" class="img-thumbnail" style="height: 100px; width: 100px; object-fit: cover; border-radius: 50%;">
                                        <div class="mt-1 text-muted small">Imagem atual (n√£o ser√° alterada a menos que voc√™ fa√ßa upload de uma nova)</div>
                                    </div>
                                    <input type="file" class="form-control" id="item3_image" name="item3_image" accept="image/*" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="fun_comment" class="form-label">Coment√°rio Divertido</label>
                        <textarea class="form-control" id="fun_comment" name="fun_comment" rows="3" required
                                  placeholder="Um coment√°rio divertido sobre seus TOP 3 itens!"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar TOP 3</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete TOP3 Confirmation Modal -->
<div class="modal fade" id="deleteTop3Modal" tabindex="-1" aria-labelledby="deleteTop3ModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteTop3ModalLabel">Confirmar Exclus√£o</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir o TOP 3 "<span id="deleteTop3Title"></span>"?</p>
                <p class="text-danger">Esta a√ß√£o n√£o pode ser desfeita!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form id="deleteTop3Form" action="{% url 'main:delete_top3' 0 %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Excluir</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/home.js' %}"></script>

{% if user.is_superuser %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Setup edit buttons
        const editButtons = document.querySelectorAll('.edit-top3-btn');
        editButtons.forEach(button => {
            button.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                fetchTop3Data(id);
            });
        });
        
        // Setup delete buttons
        const deleteButtons = document.querySelectorAll('.delete-top3-btn');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                const title = this.getAttribute('data-title');
                document.getElementById('deleteTop3Title').textContent = title;
                document.getElementById('deleteTop3Form').action = "{% url 'main:delete_top3' 0 %}".replace('0', id);
            });
        });
        
        // Reset form when modal is closed
        document.getElementById('addTop3Modal').addEventListener('hidden.bs.modal', function() {
            document.getElementById('top3Form').reset();
            document.getElementById('top3_id').value = '';
            document.getElementById('addTop3ModalLabel').textContent = 'Adicionar Novo TOP 3';
            
            // Reset required attribute for image inputs
            document.getElementById('item1_image').setAttribute('required', '');
            document.getElementById('item2_image').setAttribute('required', '');
            document.getElementById('item3_image').setAttribute('required', '');
            
            // Hide all image previews
            document.getElementById('item1_image_preview').style.display = 'none';
            document.getElementById('item2_image_preview').style.display = 'none';
            document.getElementById('item3_image_preview').style.display = 'none';
        });
        
        // Fetch TOP3 data for editing
        function fetchTop3Data(id) {
            fetch(`/api/top3/${id}/`)
                .then(response => response.json())
                .then(data => {
                    // Set form title
                    document.getElementById('addTop3ModalLabel').textContent = 'Editar TOP 3';
                    
                    // Populate form fields
                    document.getElementById('top3_id').value = data.id;
                    document.getElementById('icon_class').value = data.icon_class;
                    document.getElementById('title').value = data.title;
                    document.getElementById('item1_name').value = data.item1_name;
                    document.getElementById('item1_link').value = data.item1_link || '';
                    document.getElementById('item2_name').value = data.item2_name;
                    document.getElementById('item2_link').value = data.item2_link || '';
                    document.getElementById('item3_name').value = data.item3_name;
                    document.getElementById('item3_link').value = data.item3_link || '';
                    document.getElementById('fun_comment').value = data.fun_comment;
                    
                    // Remove required attribute for image inputs when editing
                    document.getElementById('item1_image').removeAttribute('required');
                    document.getElementById('item2_image').removeAttribute('required');
                    document.getElementById('item3_image').removeAttribute('required');
                    
                    // Set image previews
                    if (data.item1_image_url) {
                        const preview1 = document.getElementById('item1_image_preview');
                        preview1.querySelector('img').src = data.item1_image_url;
                        preview1.style.display = 'block';
                    }
                    
                    if (data.item2_image_url) {
                        const preview2 = document.getElementById('item2_image_preview');
                        preview2.querySelector('img').src = data.item2_image_url;
                        preview2.style.display = 'block';
                    }
                    
                    if (data.item3_image_url) {
                        const preview3 = document.getElementById('item3_image_preview');
                        preview3.querySelector('img').src = data.item3_image_url;
                        preview3.style.display = 'block';
                    }
                })
                .catch(error => console.error('Error fetching TOP3 data:', error));
        }
    });
</script>
{% endif %}
{% endblock %}